-- Q2: Company-Employee Relationships (works for, managers, salary comparisons)
sudo mysql
CREATE DATABASE company_db;
USE company_db;
CREATE TABLE employee(employee_name VARCHAR(100) PRIMARY KEY, street VARCHAR(100), city VARCHAR(50));
CREATE TABLE company(company_name VARCHAR(100) PRIMARY KEY, city VARCHAR(50));
CREATE TABLE works(employee_name VARCHAR(100), company_name VARCHAR(100), salary DECIMAL(10,2), FOREIGN KEY(employee_name) REFERENCES employee(employee_name), FOREIGN KEY(company_name) REFERENCES company(company_name));
CREATE TABLE manages(employee_name VARCHAR(100), manager_name VARCHAR(100), FOREIGN KEY(employee_name) REFERENCES employee(employee_name));
INSERT INTO company VALUES('HDFC Bank','Mumbai'),('ICICI Bank','Delhi'),('TCS','Bangalore');
INSERT INTO employee VALUES('Amit Kumar','MG Road','Mumbai'),('Priya Sharma','Connaught Place','Delhi'),('Rahul Verma','Koramangala','Bangalore'),('Divya Singh','Andheri','Mumbai');
INSERT INTO works VALUES('Amit Kumar','HDFC Bank',65000),('Priya Sharma','ICICI Bank',45000),('Rahul Verma','HDFC Bank',80000),('Divya Singh','TCS',55000);
INSERT INTO manages VALUES('Amit Kumar','Rahul Verma'),('Priya Sharma',NULL),('Divya Singh','Amit Kumar');

-- Queries start here
SELECT w.employee_name FROM works w WHERE w.company_name='HDFC Bank';
SELECT e.employee_name FROM employee e WHERE e.employee_name NOT IN(SELECT w.employee_name FROM works w WHERE w.company_name='HDFC Bank');
SELECT company_name FROM works GROUP BY company_name ORDER BY COUNT(*) DESC LIMIT 1;
SELECT c1.company_name FROM company c1 WHERE NOT EXISTS(SELECT c2.city FROM company c2 WHERE c2.company_name='ICICI Bank' AND c2.city NOT IN(SELECT c3.city FROM company c3 WHERE c3.company_name=c1.company_name));
SELECT e.* FROM employee e JOIN works w ON e.employee_name=w.employee_name WHERE w.salary>50000;
UPDATE works SET salary=salary*1.10 WHERE company_name='HDFC Bank';
SELECT e.employee_name, m.manager_name FROM employee e LEFT JOIN manages m ON e.employee_name=m.employee_name;
SELECT e.employee_name, e.street, e.city FROM employee e JOIN works w ON e.employee_name=w.employee_name WHERE w.company_name='HDFC Bank' AND w.salary>50000;
SELECT w1.company_name FROM works w1 GROUP BY w1.company_name HAVING AVG(w1.salary)>(SELECT AVG(w2.salary) FROM works w2 WHERE w2.company_name='HDFC Bank');

--