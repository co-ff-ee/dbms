- Q12: Bank Complex Queries (same city, borrowers-depositors, indexes)
sudo mysql
CREATE DATABASE bank_db4;
USE bank_db4;
CREATE TABLE Branch(bname VARCHAR(50) PRIMARY KEY, city VARCHAR(50));
CREATE TABLE Customers(cname VARCHAR(50) PRIMARY KEY, city VARCHAR(50));
CREATE TABLE Deposit(actno INT PRIMARY KEY, cname VARCHAR(50), bname VARCHAR(50), amount DECIMAL(10,2), adate DATE, FOREIGN KEY(cname) REFERENCES Customers(cname), FOREIGN KEY(bname) REFERENCES Branch(bname));
CREATE TABLE Borrow(loanno INT PRIMARY KEY, cname VARCHAR(50), bname VARCHAR(50), amount DECIMAL(10,2), FOREIGN KEY(cname) REFERENCES Customers(cname), FOREIGN KEY(bname) REFERENCES Branch(bname));
INSERT INTO Branch VALUES('Andheri','Mumbai'),('Connaught Place','Delhi'),('Koramangala','Bangalore'),('Sitabuldi','Nagpur');
INSERT INTO Customers VALUES('Amit Kumar','Mumbai'),('Priya Sharma','Nagpur'),('Rahul Verma','Bangalore'),('Sunil Gupta','Nagpur');
INSERT INTO Deposit VALUES(1001,'Amit Kumar','Andheri',125000,'1996-05-15'),(1002,'Priya Sharma','Sitabuldi',75000,'1996-12-20'),(1003,'Rahul Verma','Koramangala',150000,'1997-01-10'),(1004,'Sunil Gupta','Sitabuldi',95000,'1996-08-25');
INSERT INTO Borrow VALUES(2001,'Amit Kumar','Andheri',50000),(2002,'Priya Sharma','Sitabuldi',2500),(2003,'Rahul Verma','Koramangala',35000);

-- Queries start here
SELECT DISTINCT c.cname FROM Customers c JOIN Deposit d ON c.cname=d.cname JOIN Branch b ON d.bname=b.bname WHERE c.city='Mumbai' AND b.city='Nagpur';
SELECT DISTINCT c.cname FROM Customers c JOIN Deposit d ON c.cname=d.cname JOIN Branch b ON d.bname=b.bname WHERE c.city=b.city;
SELECT DISTINCT c.cname FROM Customers c JOIN Deposit d ON c.cname=d.cname JOIN Borrow br ON c.cname=br.cname WHERE c.city='Nagpur';
SELECT DISTINCT br.cname FROM Borrow br JOIN Deposit d ON br.cname=d.cname WHERE d.amount>1000 AND br.amount>2000;
SELECT DISTINCT c.cname FROM Customers c WHERE c.city=(SELECT b.city FROM Branch b JOIN Deposit d ON b.bname=d.bname WHERE d.cname='Sunil Gupta');
CREATE INDEX idx_deposit_cname ON Deposit(cname);