-- Q6: Hotel Vacancy & Lost Income (unoccupied rooms, guests by location, views)
sudo mysql
CREATE DATABASE hotel_db4;
USE hotel_db4;
CREATE TABLE Hotel(HotelNo INT PRIMARY KEY, Name VARCHAR(100), City VARCHAR(50));
CREATE TABLE Room(RoomNo INT, HotelNo INT, Type VARCHAR(50), Price DECIMAL(10,2), PRIMARY KEY(RoomNo,HotelNo), FOREIGN KEY(HotelNo) REFERENCES Hotel(HotelNo));
CREATE TABLE Guest(GuestNo INT PRIMARY KEY, GuestName VARCHAR(100), GuestAddress VARCHAR(200));
CREATE TABLE Booking(HotelNo INT, GuestNo INT, DateFrom DATE, DateTo DATE, RoomNo INT, PRIMARY KEY(HotelNo,GuestNo,DateFrom), FOREIGN KEY(HotelNo) REFERENCES Hotel(HotelNo), FOREIGN KEY(GuestNo) REFERENCES Guest(GuestNo));
INSERT INTO Hotel VALUES(1,'Taj Palace','Mumbai'),(2,'Oberoi Grand','Delhi'),(3,'ITC Royal','Bangalore');
INSERT INTO Guest VALUES(101,'Rohan Mehta','Bandra Mumbai'),(102,'Kavya Patel','Dwarka Delhi'),(103,'Arjun Singh','Whitefield Bangalore');
INSERT INTO Room VALUES(101,1,'Single',3500.00),(102,1,'Double',6000.00),(103,1,'Family',8500.00),(201,2,'Single',4000.00),(202,2,'Double',6500.00),(301,3,'Double',7000.00);
INSERT INTO Booking VALUES(1,101,'2025-11-10',NULL,101),(1,102,'2025-11-09',NULL,102),(2,103,'2025-11-08','2025-11-12',201);

-- Queries start here
SELECT * FROM Hotel;
SELECT * FROM Hotel WHERE City='Mumbai';
SELECT g.* FROM Guest g JOIN Booking b ON g.GuestNo=b.GuestNo JOIN Hotel h ON b.HotelNo=h.HotelNo WHERE h.Name='Taj Palace' AND b.DateTo IS NULL;
SELECT GuestName, GuestAddress FROM Guest WHERE GuestAddress LIKE '%Mumbai%' ORDER BY GuestName ASC;
SELECT * FROM Booking WHERE DateTo IS NULL;
SELECT COUNT(*) FROM Hotel;
SELECT r.RoomNo, r.Type, r.Price FROM Room r LEFT JOIN Booking b ON r.RoomNo=b.RoomNo AND r.HotelNo=b.HotelNo AND b.DateTo IS NULL JOIN Hotel h ON r.HotelNo=h.HotelNo WHERE h.Name='Taj Palace' AND b.GuestNo IS NULL;
SELECT h.Name, SUM(r.Price) AS lost_income FROM Hotel h JOIN Room r ON h.HotelNo=r.HotelNo LEFT JOIN Booking b ON r.RoomNo=b.RoomNo AND r.HotelNo=b.HotelNo AND CURDATE() BETWEEN b.DateFrom AND COALESCE(b.DateTo,CURDATE()) WHERE b.GuestNo IS NULL GROUP BY h.Name;
CREATE INDEX idx_guest_name ON Guest(GuestName);
EXPLAIN SELECT * FROM Guest WHERE GuestName='Rohan Mehta';
CREATE VIEW CurrentGuests AS SELECT g.GuestNo, g.GuestName, h.Name AS HotelName FROM Guest g JOIN Booking b ON g.GuestNo=b.GuestNo JOIN Hotel h ON b.HotelNo=h.HotelNo WHERE b.DateTo IS NULL;
SELECT * FROM CurrentGuests;
